_target_: src.losses.objective.Objective

n_step_max: ${max:${train.train_steps}, ${train.val_steps}, ${train.test_steps}}
decay: 0.99
quat_weight: 1.0
quat_loss_type: geodesic 
quat_norm_weight: 0.1

weights: 
  pred_x: 1.0
  pred_z: 1.0
  recon_z: 0.1
  veronese_consistency: 0.1 
  spectral: 0.01 
  isometric: 0.01

targets:
  pred_x:
    _target_: src.losses.components.quat.QuatLoss
    n_step_max: ${...n_step_max}
    weight_decay: ${...decay}
    weight: ${...weights.pred_x}
    key_pred: x_traj
    key_target: x_traj_gt
    quat_norm_weight: 0.0 
    quat_indices: ${data.quat_indices}
    quat_loss_type: ${...quat_loss_type}
    quat_weight: ${...quat_weight}

  pred_z:
    _target_: src.losses.components.base.BaseLoss
    n_step_max: ${...n_step_max}
    weight_decay: ${...decay}
    weight: ${...weights.pred_z}
    key_pred: z_traj
    key_target: z_traj_gt

  recon_z:
    _target_: src.losses.components.base.BaseLoss
    n_step_max: ${...n_step_max}
    weight_decay: ${...decay}
    weight: ${...weights.recon_z}
    key_pred: z_traj_re
    key_target: z_traj

  # 5. Veronese Consistency (z space)
  veronese_consistency:
    _target_: src.losses.components.veronese.VeroneseConsistencyLoss
    n_step_max: ${...n_step_max}
    weight_decay: ${...decay}
    weight: ${...weights.veronese_consistency}
    
    # Required by BaseLoss
    key_pred: z_traj
    key_target: z_traj_gt # Dummy target

    # Defaults
    veronese_dim: 10
    veronese_start_dim: 7 # 4(q)+3(w)
    quat_start_dim: 0
    quat_dim: 4
    scale_off_diagonals: false # False for Version 4 (no sqrt(2))

  # 6. Spectral Radius (Stability)
  # Modified for V5: Uses Discrete A directly
  spectral:
    _target_: src.losses.components.spectral.SpectralRadiusLoss
    n_step_max: ${...n_step_max}
    weight_decay: ${...decay}
    weight: ${...weights.spectral}
    
    # Required by BaseLoss
    key_pred: A_dt # Changed from A_ct
    key_target: A_dt # Changed from A_ct

    key_A: A_dt # Using Discrete A directly
    mode: discrete # |lambda| <= 1.0
    subsample: 32 

  isometric:
    _target_: src.losses.components.isometry.IsometryLoss
    n_step_max: ${...n_step_max}
    weight_decay: ${...decay}
    weight: ${...weights.isometric}
    
    key_pred: z_traj_gt
    key_target: x_traj_gt
    
    min_scale: 1.0
    sample_size: 512
    
    quat_indices: ${data.quat_indices}
    quat_norm_weight: ${...quat_norm_weight}
    quat_loss_type: ${...quat_loss_type}
    # Exclude q(0-3), w(4-6), veronese(7-16) -> Total 17 indices to exclude
    exclude_z_idx: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]

